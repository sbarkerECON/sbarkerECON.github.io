<!DOCTYPE html>
<html lang="en">
<head>
<title>How to test procedural functions with PHPUnit</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://unixsheikh.com/feed.rss">
<link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
<link rel="stylesheet" type="text/css" href="../includes/css/stylesheet.css">
</head>
<body>
<header>
<nav>[ <a class="nav-btn" href="../">Home</a> • <a class="nav-btn" href="../about.html">About</a> • <a class="nav-btn" href="../faq.html">FAQ</a> • <a class="nav-btn" href="../hire-me.html">Hire me</a> • <a class="nav-btn" href="../contact.html">Contact</a> • <a class="nav-btn rss" href="../feed.rss">RSS</a> • <a class="nav-btn" href="../tutorials.html">Tutorials only</a> • <a class="nav-btn" href="../articles.html">Articles only</a> ]</nav>
</header>
<article>

<h1>How to test procedural functions with PHPUnit</h1>
<p class="post-data">Published on <span id="pubdate">2021-03-30</span>. Modified on <span id="moddate">2021-03-31</span>.</p>
<p class="info info-yellow abstract">Some people argue that you cannot test procedural PHP code, but that is not true. In this small tutorial I am going to show you how you can use <a href="https://phpunit.de/">PHPUnit</a> to test your procedural functions.</p>

<p>Take a look at the <a href="https://phpunit.readthedocs.io/">documentation</a> for relevant information about how to use PHPUnit.</p>

<p>All official releases of code distributed by the PHPUnit Project are signed by the release manager for the release. PGP signatures and SHA256 hashes are available for verification on <a href="https://phar.phpunit.de/">phar.phpunit.de</a></p>

<p>In this simple example I am going to use the phar version of PHPUnit.</p>

<p>We start by downloading <code>phpunit.phar</code> as well as its detached PGP signature <code>phpunit.phar.asc</code>:</p>

<pre>$ wget https://phar.phpunit.de/phpunit-9.5.phar
$ wget https://phar.phpunit.de/phpunit-9.5.phar.asc</pre>

<p>In order to proceed with the verification we need to retrieve the release manager's public key from a key server:</p>

<pre>$ curl --silent https://sebastian-bergmann.de/gpg.asc | gpg --import</pre>

<p>Then we verify the signature:</p>

<pre>$ gpg phpunit-9.5.phar.asc
gpg: WARNING: no command supplied.  Trying to guess what you mean ...
gpg: assuming signed data in 'phpunit-9.5.phar'
gpg: Signature made tir 23 mar 2021 08:16:55 CET
gpg:                using RSA key D8406D0D82947747293778314AA394086372C20A
gpg:                issuer "sb@sebastian-bergmann.de"
gpg: Good signature from "Sebastian Bergmann <sb@sebastian-bergmann.de>" [unknown]
gpg:                 aka "Sebastian Bergmann <sebastian@thephp.cc>" [unknown]
gpg:                 aka "Sebastian Bergmann <sebastian@phpunit.de>" [unknown]
gpg:                 aka "Sebastian Bergmann <sebastian@php.net>" [unknown]
gpg:                 aka "Sebastian Bergmann <sebastian.bergmann@thephp.cc>" [unknown]
gpg:                 aka "[jpeg image of size 40635]" [unknown]
gpg: WARNING: This key is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: D840 6D0D 8294 7747 2937  7831 4AA3 9408 6372 C20A</sebastian.bergmann@thephp.cc></sebastian@php.net></sebastian@phpunit.de></sebastian@thephp.cc></sb@sebastian-bergmann.de></pre>

<p>The signature is good and a good signature means that the file has not been tampered with. However, due to the nature of public key cryptography, you need to additionally verify that the primary key fingerprint was created by the real Sebastian Bergmann. I am going to leave that up to you to figure out :)</p>

<p>Then we make the script executable:</p>

<pre>$ chmod +x phpunit-9.5.phar
$ ./phpunit-9.5.phar --version
PHPUnit x.y.z by Sebastian Bergmann and contributors</pre>

<p>Now we're ready to do some testing.</p>

<p>Let's create a single file in our public directory and put a couple of functions into it:</p>

<pre>$ vim public/foo.php

&lt;?php
declare(strict_types=1);

function bar(string $string): string {
    return $string;
}

function add(int $a, int $b): int {
    return $a + $b;
}
</pre>

<p>Then we create a test file for <code>foo.php</code>:</p>

<pre>$ vim test_foo.php

&lt;?php declare(strict_types=1);
use PHPUnit\Framework\TestCase;

// We require the file we need to test.
require 'public/foo.php';

final class test_foo extends TestCase
{
    public function test_bar() {
        $this-&gt;assertEquals('Hello', bar('Hello'));
        $this-&gt;assertEquals('Hi', bar('Hi'));
    }

    public function test_add() {
        $this-&gt;assertEquals(4, add(1, 3));
        $this-&gt;assertEquals(10, add(4, 6));
    }
}
</pre>

<p>Make sure that the class name you use match the actual filename of the test file.</p>

<p>The run the test:</p>

<pre>$ ./phpunit-9.5.phar --colors test_foo.php
PHPUnit 9.5.4 by Sebastian Bergmann and contributors.

..                                                                  2 / 2 (100%)

Time: 00:00.020, Memory: 18.00 MB

OK (2 tests, 4 assertions)
</pre>

<p>Let's make the test fail by changing the assertion test for the <code>add</code> function. Change it to something that is wrong:</p>

<pre>$this-&gt;assertEquals(15, add(4, 6));</pre>

<p>This should fail because 4 + 6 is not 15:</p>

<pre>$ ./phpunit-9.5.phar --colors test_foo.php
PHPUnit 9.5.4 by Sebastian Bergmann and contributors.

.F                                                                  2 / 2 (100%)

Time: 00:00.019, Memory: 18.00 MB

There was 1 failure:

1) test_foo::test_add
Failed asserting that 10 matches expected 15.

test_foo.php:15

FAILURES!
Tests: 2, Assertions: 4, Failures: 1.</pre>

<p>That's pretty much it. Take a look at the <a href="https://phpunit.readthedocs.io/">documentation</a> for relevant information about other kinds of tests.</p>

</article>
<footer><i>If you have any comments or corrections please feel free to email them to me. Also, if you found this content useful consider supporting me on <a href="https://patreon.com/unixsheikh">Patreon</a></i> ;)</footer>
</body>
</html>
